<!-- 工作站模式 -->
<style>
.over_hid {
	overflow: hidden;
	text-overflow: ellipsis;
}
</style>

<div id="workstation" class="text-left shadow">
	<div class=" bg-white rounded-top m-0 pl-1 h5">
		<i class="bi bi-joystick mr-1"></i>Workstation-<b id="workstation_name">組裝工作站</b>
	</div>
	<div class="p-2">
		<form onsubmit="return workstation.send_save();">
			<table class="table table-sm  table-bordered table-responsive m-0 bg-white" style="min-height: 60vh">
				<thead class="thead bg-dark table-dark">
					<tr>
						<th style="min-width: 35px;" class="text-center">
							<div>
								<i id="barcode_open" class="bi bi-upc-scan btn btn-outline-primary p-0 pl-1 pr-1"></i>
							</div>
						</th>
						<th style="min-width: 10px;">
							<div id="barcode_status" class="barcode_open" style="display: none;">
								<div style="min-width: 80px;">Barcode</div>
							</div>
						</th>
						<th style="min-width: 300px; width: 100%;">Info</th>
						<th class="">
							<div>
								<i id="fix_open" class="bi bi-tools btn btn-outline-primary p-0 pl-1 pr-1"></i>
							</div>
						</th>
						<th style="min-width: 35px;">
							<div>
								<i class="bi bi-shield-slash btn btn-outline-danger p-0 pl-1 pr-1 d-none"></i>
							</div>
							<div>
								<i class="bi bi-shield-lock btn btn-outline-success p-0 pl-1 pr-1"></i>
							</div>
						</th>
						<th style="min-width: 35px;" class="text-center">
							<div>
								<i id="doc_open" class="bi bi-layout-text-sidebar-reverse btn btn-outline-primary p-0 pl-1 pr-1"></i>
							</div>
						</th>
						<th style="min-width: 10px;">
							<div id="doc_status" class="doc_open" style="display: none;">
								<div style="min-width: 380px;">Doc</div>
							</div>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<!-- fix -->
						<td colspan="7" class="p-0 border border-dark">
							<div class="row justify-content-between m-0">
								<div id="barcode_open_barcode" class="row m-0 p-2">
									<div>open_barcode[BC008]</div>
									<div id="barcode_BC008" class="m-1"></div>
								</div>
								<div id="barcode_open_fix" class="row m-0 p-2">
									<div>open_fix[BC009]</div>
									<div id="barcode_BC009" class="m-1"></div>
								</div>
								<div id="barcode_open_doc" class="row m-0 p-2">
									<div>open_doc[BC010]</div>
									<div id="barcode_BC010" class="m-1"></div>
								</div>
							</div> <!-- 維修條碼_類型(浮動) -->
							<div id="fix_type_open" class="col-12 row justify-content-between m-0 text-center p-0 border border-secondary rounded" style="display: none;">
								<div class="col-12 m-0 p-0 h4">Fix-type</div>
								<div class="p-2">
									<div class="row m-0 p-1">
										<div id="BC011" class="barcode_action btn btn-light p-0 pr-2 pl-2">XXX[BC011]</div>
										<div id="barcode_BC011" class="m-1"></div>
									</div>
								</div>
							</div> <!-- 維修條碼_項目(浮動) -->
							<div id="fix_item_open" class="col-12 row justify-content-between m-0 text-center p-0 border border-secondary rounded" style="display: none;">
								<div class="col-12 m-0 p-0 h4">Fix-item</div>
								<div class="p-2">
									<div class="row m-0">
										<div id="BC012" class="barcode_action btn btn-light p-0 pr-2 pl-2">XXX[BC012]</div>
										<div id="barcode_BC012" class="m-1"></div>
									</div>
								</div>
							</div>
						</td>
					</tr>
					<tr id="barcode_work" class="w_i_1 font-weight-bold">
						<!-- 動作機制 -->
						<td colspan="2" rowspan="100" class="p-0 pl-1 pr-1  text-center small border-dark border">
							<div class="barcode_open" style="display: none;">
								<div class="p-2" id="previous">
									<div id="barcode_BC001"></div>
									<div id="BC001" class="btn btn-sm btn-light col-12 p-0 m-0 mt-1 barcode_action">
										<div class="small font-weight-bold">
											previous(上)<br>[BC001]
										</div>
									</div>
								</div>
								<div class="p-2" id="next">
									<div id="barcode_BC002"></div>
									<div id="BC002" class="btn btn-sm btn-light col-12 p-0 m-0 mt-1 barcode_action">
										<div class="small font-weight-bold">
											next(下)<br>[BC002]
										</div>
									</div>
								</div>
								<div class="dropdown-divider p-1 mt-3"></div>
								<div class="p-2" id="check">
									<div id="barcode_BC003"></div>
									<div id="BC003" class="btn btn-sm btn-light col-12 p-0 m-0 mt-1 barcode_action">
										<div class="small font-weight-bold">
											check(檢查)<br>[BC003]
										</div>
									</div>
								</div>
								<div class="p-2" id="save">
									<div id="barcode_BC004"></div>
									<div id="BC004" class="btn btn-sm btn-light col-12 p-0 m-0 mt-1 barcode_action">
										<div class="small font-weight-bold">
											save(完成)<br>[BC004]
										</div>
									</div>
								</div>
								<div class="dropdown-divider p-1 mt-3"></div>
								<div class="p-2" id="clear">
									<div id="barcode_BC005"></div>
									<div id="BC005" class="btn btn-sm btn-light col-12 p-0 m-0 mt-1 barcode_action">
										<div class="small font-weight-bold">
											clear(清除)<br>[BC005]
										</div>
									</div>
								</div>
								<div class="p-2" id="cancel">
									<div id="barcode_BC006"></div>
									<div id="BC006" class="btn btn-sm btn-light col-12 p-0 m-0 mt-1 barcode_action">
										<div class="small font-weight-bold">
											all cancel(取消)<br>[BC006]
										</div>
									</div>
								</div>
								<div class="dropdown-divider p-1 mt-3"></div>
								<div class="p-2" id="logout">
									<div id="barcode_BC007"></div>
									<div id="BC007" class="btn btn-sm btn-light col-12 p-0 m-0 mt-1 barcode_action">
										<div class="small font-weight-bold">
											logout(登出)<br>[BC007]
										</div>
									</div>
								</div>
							</div>
						</td>
						<td colspan="2" class="p-0">
							<div class="row p-1 m-0 border  border-light rounded">
								<div class="col-5 p-1 m-0">*工作站:</div>
								<div class="col-7 p-0">
									<input id="w_focus_1" disabled="disabled" class="w_sn_value col p-1 border-1 border-primary rounded" type="text" required>
								</div>
							</div>
						</td>
						<td class="p-1 border border-dark border-bottom-0">
							<div class="w_i_success">
								<i class="bi bi-shield-check text-success p-0 h3 d-none"></i>
							</div>
							<div class="w_i_warning">
								<i class="bi bi-shield-exclamation text-warning p-0 h3"></i>
							</div>
							<div class="w_i_danger">
								<i class="bi bi-shield-x text-danger p-0 h3 d-none"></i>
							</div>
						</td>
						<!-- Doc -->
						<td colspan="2" class="p-1 border border-dark" rowspan="100">
							<!-- (固定)顯特定內容 -->
							<div class="doc_open" style="display: none;">
								<div id="doc_example" style="min-width: 380px;">
									<!-- (固定)顯特定內容 (製令資訊/軟體定義/規格定義)-->
									<div id="doc_content_x" class="border border-secondary rounded">
										<div id="" class="doc_t_name p-1">XX</div>
										<div id="" class="p-0 row m-0">
											<div class="col-6 p-0">
												<div class="m-0 p-1">
													<div class="col-12 doc_c_name p-0 over_hid" id="">XX</div>
													<input disabled="disabled" class="col-12  p-0 border border-light rounded doc_c_value" id="" type="text" required>
													<textarea disabled="disabled" class="col-12  p-0 border border-light rounded doc_c_value d-none" id="" rows="5" required></textarea>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</td>
					</tr>
					<!--(固定) -->
					<tr id="barcode_order" class="w_i_2 font-weight-bold">
						<td colspan="2" class="p-0">
							<div class=" row p-1 m-0 border border-light rounded">
								<div class="col-5 p-1 m-0">*製令單:</div>
								<div class="col-7 p-0">
									<input id="w_focus_2" disabled="disabled" class="w_sn_value col p-1 border-0 border-primary rounded" type="text" required>
								</div>
							</div>
						</td>
						<td class="p-1">
							<div class="w_i_success">
								<i class="bi bi-shield-check text-success p-0 h3 d-none"></i>
							</div>
							<div class="w_i_warning">
								<i class="bi bi-shield-exclamation text-warning p-0 h3"></i>
							</div>
							<div class="w_i_danger">
								<i class="bi bi-shield-x text-danger p-0 h3 d-none"></i>
							</div>
						</td>
					</tr>
					<!--(固定) -->
					<tr id="barcode_sn" class="w_i_3 font-weight-bold">
						<td colspan="2" class="p-0">
							<div class=" row p-1 m-0 border border-light rounded">
								<div class="col-5 p-1 m-0">*產品SN:</div>
								<div class="col-7 p-0">
									<input id="w_focus_3" disabled="disabled" class="w_sn_value col p-1 border-0 border-primary rounded" type="text" required>
								</div>
							</div>
						</td>
						<td class="p-1">
							<div class="w_i_success">
								<i class="bi bi-shield-check text-success p-0 h3 d-none"></i>
							</div>
							<div class="w_i_warning">
								<i class="bi bi-shield-exclamation text-warning p-0 h3"></i>
							</div>
							<div class="w_i_danger">
								<i class="bi bi-shield-x text-danger p-0 h3 d-none"></i>
							</div>
						</td>
					</tr>
					<!--(固定) -->
					<tr id="barcode_fix" class="w_i_4 font-weight-bold">
						<td colspan="2" class="p-0">
							<div class=" row p-1 m-0 border border-light rounded">
								<div class="col-5 p-1 m-0">*故障代碼(可複數):</div>
								<div class="col-7 p-0">
									<input id="w_focus_4" disabled="disabled" class="w_sn_value col p-1 border-0 border-primary rounded" type="text" required>
								</div>
							</div>
						</td>
						<td class="p-1">
							<div class="w_i_success">
								<i class="bi bi-shield-check text-success p-0 h3 d-none"></i>
							</div>
							<div class="w_i_warning">
								<i class="bi bi-shield-exclamation text-warning p-0 h3"></i>
							</div>
							<div class="w_i_danger">
								<i class="bi bi-shield-x text-danger p-0 h3 d-none"></i>
							</div>
						</td>
					</tr>
					<!--(固定) -->
					<tr id="barcode_path" class="w_i_5 font-weight-bold">
						<td colspan="2" class="p-0 ">
							<div class=" row p-1 m-0 border border-light rounded">
								<div class="col-5 p-1 m-0">*置物位置:</div>
								<div class="col-7 p-0">
									<input id="w_focus_5" disabled="disabled" class="w_sn_value col p-1 border-0 border-primary rounded" type="text" required>
								</div>
							</div>
						</td>
						<td class="p-1">
							<div class="w_i_success">
								<i class="bi bi-shield-check text-success p-0 h3 d-none"></i>
							</div>
							<div class="w_i_warning">
								<i class="bi bi-shield-exclamation text-warning p-0 h3"></i>
							</div>
							<div class="w_i_danger">
								<i class="bi bi-shield-x text-danger p-0 h3 d-none"></i>
							</div>
						</td>
					</tr>
					<tr class="font-weight-bold">
						<td colspan="3" class="pr-0 pl-0">
							<div class="dropdown-divider p-0 m-0 border border-dark"></div>
						</td>
					</tr>
					<tr class="font-weight-bold">
						<!--(固定)目前條碼 -->
						<td colspan="2" class="p-0">
							<div class=" row p-1 m-0 border border-light rounded h2">
								<div class="col-5 p-1 m-0">Barcode in:</div>
								<div class="col-7 p-0">
									<input autocomplete="off" class="col p-1 rounded" id="m_order" type="text" required autofocus>
								</div>
							</div>
						</td>
						<!-- 鎖定 -->
						<td class="p-1">
							<div>
								<i class="bi bi-shield-check text-success p-0 h3"></i>
							</div>
							<div>
								<i class="bi bi-shield-exclamation text-warning p-0 h3 d-none"></i>
							</div>
						</td>
					</tr>
					<tr class="font-weight-bold">
						<td colspan="3" class="pr-0 pl-0">
							<div class="dropdown-divider p-0 m-0 border border-dark"></div>
						</td>
					</tr>
					<!-- 工作項目(浮動) Manufacturing order-->
					<tr class="w_i_6 workstation_example font-weight-bold">
						<td colspan="2" class="p-0">
							<div class=" row p-1 m-0 border border-light rounded">
								<div class="w_sn_name col-5 p-1 m-0">XXX</div>
								<div class="col-7 p-0">
									<input id="w_focus_6" class="w_sn_value col p-1 border-0 border-primary rounded" disabled="disabled" type="text" required>
								</div>
							</div>
						</td>
						<td class="p-1">
							<div class="w_i_success">
								<i class="bi bi-shield-check text-success p-0 h3 d-none"></i>
							</div>
							<div class="w_i_warning">
								<i class="bi bi-shield-exclamation text-warning p-0 h3"></i>
							</div>
							<div class="w_i_danger">
								<i class="bi bi-shield-x text-danger p-0 h3 d-none"></i>
							</div>
						</td>
					</tr>

					<!-- 功能(固定) -->
					<tr>
						<td colspan="3" rowspan="2" class="p-0 border border-dark">
							<div class="shadow-sm text-left">
								<div class=" bg-white rounded-top m-0 pl-1 h5">
									<i class="bi bi-file-earmark-check mr-1"></i> Action
								</div>
								<div class="col-12 p-2 m-0 row justify-content-center">
									<button class="col-sm-3 mt-1 btn btn-primary btn-sm" type="submit">Send Command</button>
									<div class="col-1"></div>
									<button class="col-sm-3 mt-1 btn btn-info btn-sm" type="button">Print Barcode</button>
									<div class="col-1"></div>
									<button class="col-sm-3 mt-1 btn btn-warning btn-sm" type="button">All Cancel</button>
								</div>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
</div>
<script type="text/javascript">
	//控制端
	workstation = new Vue({
		el : "#workstation",
		//資料區
		data : {
			test : 300,
			//籃框位置
			nb:1,
			nb_max:6,
		},
		//初始化
		created : function() {
			console.log("workstation.html(created)");
			//限制動作5碼
			this.create_barcode("barcode_BC001","BC001","code39");
			this.create_barcode("barcode_BC002","BC002","code39");
			this.create_barcode("barcode_BC003","BC003","code39");
			this.create_barcode("barcode_BC004","BC004","code39");
			this.create_barcode("barcode_BC005","BC005","code39");
			this.create_barcode("barcode_BC006","BC006","code39");
			this.create_barcode("barcode_BC007","BC007","code39");
			//標籤開關
			this.create_barcode("barcode_BC008","BC008","code39");
			this.create_barcode("barcode_BC009","BC009","code39");
			this.create_barcode("barcode_BC010","BC010","code39");
			//維修代號
			this.create_barcode("barcode_BC011","BC011","code39");
			this.create_barcode("barcode_BC012","BC012","code39");
			this.create_barcode("barcode_BC013","BC013","code39");
			
			
			
			
			//barcode_open 顯示 ?
			$(document).on("click", "#barcode_open", function (event) {
			    console.log("barcode_open");
				   $(".barcode_open").toggle("fast");

			});
			//doc_open 顯示 ?
			$(document).on("click", "#doc_open", function (event) {
			    console.log("doc_open");
			    $(".doc_open").toggle("fast");
			});
			//fix_open 顯示?
			$(document).on("click", "#fix_open", function (event) {
			    console.log("doc_open");
			    $("#fix_type_open").slideToggle("fast");
			    //如果顯示則關閉
			    if($("#fix_item_open").css('display')!='none'){
			    	  $("#fix_item_open").slideToggle("fast");
			    }
			});
			//barcode_action-> m_order行為執行?
			$(document).on("click", ".barcode_action", function (event) {
			    console.log("barcode_action");
			    console.log(event.currentTarget.id);
			    $("#m_order").val(event.currentTarget.id);
			});

		},
		//可呼叫方法
		methods : {
			//建立 一維條碼
			create_barcode(taget_id,barcode_val,code){
				/*
				barWidth: 1,barHeight: 50,
				moduleSize: 5,showHRI: true,
				addQuietZone: true,	marginHRI: 5,
				bgColor: "#FFFFFF",	color: "#000000",
				fontSize: 10,output: "css",
				posX: 0,posY: 0
				*/
				var barcode_f = {barWidth:1,barHeight:15,showHRI:false,};
				$("#"+taget_id).barcode(barcode_val,code,barcode_f);     
			},
			//執行動作
			send_save(){
				setTimeout(function(){
					console.log("send_save :"+$('#m_order').val() );
					var code = $('#m_order').val();
					var id =$(".border-1").attr("id");
					//指令類型
					switch(code){
					case "BC001":
						//目前代碼位置 
						if(workstation.nb>1){
							console.log(id);
							workstation.nb = parseInt(id.replace('w_focus_',''));
							workstation.nb-=1;
							//更換Class
							$("#"+id).removeClass("border-1");
							$("#"+id).addClass("border-0");
							$("#w_focus_"+workstation.nb).addClass("border-1");
							$("#w_focus_"+workstation.nb).removeClass("border-0");
						}
						return false;
						break;
					case "BC002":
						//目前代碼位置 
						if(workstation.nb<workstation.nb_max){
							console.log(id);
							workstation.nb = parseInt(id.replace('w_focus_',''));
							workstation.nb+=1;
							//更換Class
							$("#"+id).removeClass("border-1");
							$("#"+id).addClass("border-0");
							$("#w_focus_"+workstation.nb).addClass("border-1");
							$("#w_focus_"+workstation.nb).removeClass("border-0");
						}
						return false;
						break;
					case "BC003":
						$("#barcode_open" ).trigger( "click" );
						return false;
						break;
					case "BC004":
						$("#barcode_open" ).trigger( "click" );
						return false;
						break;
					case "BC005":
						$('#'+id).val("");
						return false;
						break;
					case "BC006":
						$('.w_sn_value' ).val("");
						return false;
						break;
					case "BC007":
						//登出
						window.location.replace("./logout.basil");
						return false;
						break;
					case "BC008":
						//顯示barcode
						$("#barcode_open" ).trigger( "click" );
						return false;
						break;
					case "BC009":
						//顯示fix
						$("#fix_open").trigger( "click" );
						if($("#fix_item_open").css("display")!="none"){
							$("#fix_item_open").slideToggle("fast");
						}
						return false;
						break;
					case "BC010":
						//顯示doc
						$("#doc_open" ).trigger( "click" );
						return false;
						break;
					default:
						
						break;
					}
					//是否為維修代碼
					if(code=="BC011"){
						 $("#fix_item_open").slideToggle("fast");
					}
					if(code=="BC012"){
						 $("#fix_item_open").slideToggle("fast");
					}
					//輸入一般值->換下一格
					$('#'+id).val(code);
					if(workstation.nb<workstation.nb_max){
						console.log(id);
						workstation.nb = parseInt(id.replace('w_focus_',''));
						workstation.nb+=1;
						//更換Class
						$("#"+id).removeClass("border-1");
						$("#"+id).addClass("border-0");
						$("#w_focus_"+workstation.nb).addClass("border-1");
						$("#w_focus_"+workstation.nb).removeClass("border-0");
					}

				  }, 400);
				setTimeout(function(){
					//清除
					$('#m_order').val('');
					$('#m_order').focus();
				  }, 500);
				
				return false; //防止真傳送
			},
			ajaxSend(url, dataSend) {

			},
		},
		//移除監聽事件
		beforeDestroy() {
			console.log("workstation.html(beforeDestroy)");
			$(document).off("click", "#barcode_open");
			$(document).off("click", "#doc_open");
			$(document).off("click", "#fix_open");
			$(document).off("click", ".barcode_action");
			
			
			
			
		}
	});
</script>